      <% if (typeof successMessage !== 'undefined' && successMessage) { %>
        <div class="alert alert-success mt-2">
          <%= successMessage %>
        </div>
      <% } %>

      <% if (typeof errorMessage !== 'undefined' && errorMessage) { %>
        <div class="alert alert-danger mt-2">
          <%= errorMessage %>
        </div>
      <% } %>
    </section>

    <% if (account && account.group_id >= 2) { %>
      <div class="admin-btn-container">
        <a href="/admin/server" class="admin-btn">
          Painel de Administrador
        </a>
      </div>
    <% } %>

    <nav class="dashboard-nav">
      <button class="nav-tab active" data-tab="characters">
        Meu Perfil
      </button>
      <button class="nav-tab" data-tab="tickets">Meus Tickets</button>
    </nav>

    <div class="dashboard-tab-content">
      <div id="characters-tab" class="tab-pane active">
        <div class="dashboard-sections-wrapper">
          <div class="dashboard-main-column">
            <section class="dashboard-section">
              <div class="dashboard-section-container">
                <div class="section-header">
                  <h2>Seus Personagens</h2>
                </div>

                <div class="character-grid">
                    <% if (characters && characters.length > 0) { %>
                        <% characters.forEach(char => { %>
                            <div class="character-card">
                              <div class="character-avatar-wrapper" style="background-image: url('/assets/images/characters/background.png');">
                                <img class="avatar" src="/avatar/<%= char.name %>" alt="<%= char.name %> Avatar" width="64" height="64" />
                              </div>
                              <div class="info">
                                <div class="character-header">
                                   <div class="character-name-and-status">
                                       <h3><%= char.name %></h3>
                                       <span class="status-dot <%= char.online === 1 ? 'on' : 'off' %>" title="<%= char.online === 1 ? 'Online' : 'Offline' %>"></span>
                                   </div>
                                   <div class="character-actions">
                                        <button class="btn-icon btn-delete data-char-delete" data-id="<%= char.id %>" data-name="<%= char.name %>" title="Excluir Personagem">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                   </div>
                                </div>
                                <div class="character-info">
                                     <p><span class="info-label">Level:</span> <%= char.level %></p>
                                     <p><span class="info-label">Criado em:</span> <%= new Date(char.created * 1000).toLocaleDateString() %></p>
                                </div>
                              </div>
                            </div>
                        <% }) %>
                    <% } else { %>
                       <div class="no-characters-message">
                         <p>Você ainda não tem personagens.</p>
                       </div>
                    <% } %>
                </div>

                <div class="create-character-banner">
                  <% if (canCreateCharacter) { %>
                    <button class="btn btn-secondary" id="btn-open-create-modal">
                      <span class="plus-icon">+</span> Criar Personagem
                    </button>
                  <% } else { %>
                    <p class="limit-message">
                      Você atingiu o limite de <%= maxPlayersPerAccount %> personagens.
                    </p>
                  <% } %>
                </div>
              </div>
            </section>
          </div>

          <div class="dashboard-side-column">
            <section class="dashboard-section">
              <div class="fancy-card">
                <h2 class="card-title">Sua Carteira</h2>
                <div class="rcoins-amount">
                  <%= account.rcoins %> <span>Coins</span>
                </div>
                <div class="horizontal-separator"></div>
                <p class="donate-message">
                  Sua doação ajuda o servidor a se manter online e melhorar!
                </p>
                <button class="btn btn-donate" id="btn-donate">DOAR COINS</button>
              </div>
            </section>
          </div>
        </div>
      </div>

      <div id="tickets-tab" class="tab-pane">
        <section class="dashboard-section full-width-tickets">
          <div class="dashboard-section-container">
            <div class="section-header">
              <h2>Meus Tickets</h2>
            </div>
            <div id="tickets-section">
              <p>Conteúdo da aba de tickets...</p>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
</main>

<div id="createCharModal" class="modal">
  <div class="modal-content">
    <span id="btn-close-create-modal" class="close-modal">×</span>
    <h2>Criar Novo Personagem</h2>
    <form id="form-create-char">
      <div class="form-group">
        <label for="characterName">Nome do Personagem:</label>
        <input
          type="text"
          id="characterName"
          name="characterName"
          placeholder="Digite o nome do seu personagem"
          maxlength="20"
          required
        />
        <div class="character-name-feedback"></div>
      </div>

      <div class="form-group gender-selector">
        <label>Sexo:</label>
        <div class="gender-options">
          <button
            type="button"
            class="gender-option-btn active"
            data-sex="1"
          >
            <img
              src="/assets/images/icons/male.png"
              alt="Masculino"
            />
            <span>Masculino</span>
          </button>
          <button type="button" class="gender-option-btn" data-sex="0">
            <img
              src="/assets/images/icons/female.png"
              alt="Feminino"
            />
            <span>Feminino</span>
          </button>
        </div>
        <input type="hidden" id="sex" name="sex" value="1" />
      </div>

      <input type="hidden" id="picture" name="picture" value="1" />

      <div class="create-char-error alert alert-danger mt-2" style="display: none;"></div>

      <div class="form-actions">
        <button type="button" id="btn-cancel-create" class="btn btn-secondary">
          Cancelar
        </button>
        <button type="submit" class="btn btn-primary">Criar Personagem</button>
      </div>
    </form>
  </div>
</div>

<div id="deleteCharModal" class="modal">
  <div class="modal-content">
    <span id="btn-close-delete-modal" class="close-modal">×</span>
    <h2>Excluir Personagem</h2>
    <p>
      Você está prestes a excluir o personagem
      <strong id="delete-char-name"></strong>. Para confirmar, digite sua
      senha:
    </p>
    <form id="form-delete-char">
      <input
        type="hidden"
        id="delete-char-id"
        name="characterId"
        value=""
      />

      <div class="form-group">
        <label for="delete-password">Senha da Conta:</label>
        <input
          type="password"
          id="delete-password"
          name="password"
          placeholder="Digite sua senha"
          required
        />
      </div>

      <div class="delete-char-error alert alert-danger mt-2" style="display: none;"></div>

      <div class="form-actions">
        <button type="button" id="btn-cancel-delete" class="btn btn-secondary">
          Cancelar
        </button>
        <button type="submit" class="btn btn-danger">Excluir Personagem</button>
      </div>
    </form>
  </div>
</div>

<%- include('partials/footer') %>

<script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
  crossorigin="anonymous"
></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="/js/dashboard.js"></script>